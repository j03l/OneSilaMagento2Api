.. |.~.ACCESS_TOKEN| replace:: ``ACCESS_TOKEN``
.. _.~.ACCESS_TOKEN: https://my-magento.readthedocs.io/en/latest/clients.html#magento.clients.Client.ACCESS_TOKEN
.. |.~.APIResponse| replace:: ``APIResponse``
.. _.~.APIResponse: https://my-magento.readthedocs.io/en/latest/model.html#magento.models.model.APIResponse
.. |.~.Category| replace:: ``Category``
.. _.~.Category: https://my-magento.readthedocs.io/en/latest/category.html#magento.models.category.Category
.. |.~.CategorySearch| replace:: ``CategorySearch``
.. _.~.CategorySearch: https://my-magento.readthedocs.io/en/latest/search_module.html#magento.search.CategorySearch
.. |.~.Client| replace:: ``Client``
.. _.~.Client: https://my-magento.readthedocs.io/en/latest/clients.html#magento.clients.Client
.. |..Client.categories| replace:: ``Client.categories``
.. _..Client.categories: https://my-magento.readthedocs.io/en/latest/clients.html#magento.clients.Client.categories
.. |..Client.customers| replace:: ``Client.customers``
.. _..Client.customers: https://my-magento.readthedocs.io/en/latest/clients.html#magento.clients.Client.customers
.. |..Client.invoices| replace:: ``Client.invoices``
.. _..Client.invoices: https://my-magento.readthedocs.io/en/latest/clients.html#magento.clients.Client.invoices
.. |..Client.order_items| replace:: ``Client.order_items``
.. _..Client.order_items: https://my-magento.readthedocs.io/en/latest/clients.html#magento.clients.Client.order_items
.. |..Client.orders| replace:: ``Client.orders``
.. _..Client.orders: https://my-magento.readthedocs.io/en/latest/clients.html#magento.clients.Client.orders
.. |..Client.product_attributes| replace:: ``Client.product_attributes``
.. _..Client.product_attributes: https://my-magento.readthedocs.io/en/latest/clients.html#magento.clients.Client.product_attributes
.. |..Client.products| replace:: ``Client.products``
.. _..Client.products: https://my-magento.readthedocs.io/en/latest/clients.html#magento.clients.Client.products
.. |..Client.scope| replace:: ``Client.scope``
.. _..Client.scope: https://my-magento.readthedocs.io/en/latest/clients.html#magento.clients.Client.scope
.. |..Client.search| replace:: ``Client.manager()``
.. _..Client.search: https://my-magento.readthedocs.io/en/latest/clients.html#magento.clients.Client.search
.. |..Client.url_for| replace:: ``Client.url_for()``
.. _..Client.url_for: https://my-magento.readthedocs.io/en/latest/clients.html#magento.clients.Client.url_for
.. |.~.Customer| replace:: ``Customer``
.. _.~.Customer: https://my-magento.readthedocs.io/en/latest/customer.html#magento.models.customer.Customer
.. |.~.CustomerSearch| replace:: ``CustomerSearch``
.. _.~.CustomerSearch: https://my-magento.readthedocs.io/en/latest/search_module.html#magento.search.CustomerSearch
.. |.~.Invoice| replace:: ``Invoice``
.. _.~.Invoice: https://my-magento.readthedocs.io/en/latest/invoice.html#magento.models.invoice.Invoice
.. |.~.InvoiceSearch| replace:: ``InvoiceSearch``
.. _.~.InvoiceSearch: https://my-magento.readthedocs.io/en/latest/search_module.html#magento.search.InvoiceSearch
.. |.~.MediaEntry| replace:: ``MediaEntry``
.. _.~.MediaEntry: https://my-magento.readthedocs.io/en/latest/product.html#magento.models.product.MediaEntry
.. |.~.Model| replace:: ``Model``
.. _.~.Model: https://my-magento.readthedocs.io/en/latest/model.html#magento.models.model.Model
.. |..Model.refresh| replace:: ``Model.refresh()``
.. _..Model.refresh: https://my-magento.readthedocs.io/en/latest/model.html#magento.models.model.Model.refresh
.. |.~.Order| replace:: ``Order``
.. _.~.Order: https://my-magento.readthedocs.io/en/latest/order.html#magento.models.order.Order
.. |.~.OrderItem| replace:: ``OrderItem``
.. _.~.OrderItem: https://my-magento.readthedocs.io/en/latest/order.html#magento.models.order.OrderItem
.. |.~.OrderItemSearch| replace:: ``OrderItemSearch``
.. _.~.OrderItemSearch: https://my-magento.readthedocs.io/en/latest/search_module.html#magento.search.OrderItemSearch
.. |.~.OrderSearch| replace:: ``OrderSearch``
.. _.~.OrderSearch: https://my-magento.readthedocs.io/en/latest/search_module.html#magento.search.OrderSearch
.. |.~.Product| replace:: ``Product``
.. _.~.Product: https://my-magento.readthedocs.io/en/latest/product.html#magento.models.product.Product
.. |.~.ProductAttribute| replace:: ``ProductAttribute``
.. _.~.ProductAttribute: https://my-magento.readthedocs.io/en/latest/product.html#magento.models.product.ProductAttribute
.. |.~.ProductAttributeSearch| replace:: ``ProductAttributeSearch``
.. _.~.ProductAttributeSearch: https://my-magento.readthedocs.io/en/latest/search_module.html#magento.search.ProductAttributeSearch
.. |.~.ProductSearch| replace:: ``ProductSearch``
.. _.~.ProductSearch: https://my-magento.readthedocs.io/en/latest/search_module.html#magento.search.ProductSearch
.. |.~.ProductSearch.by_sku| replace:: ``by_sku()``
.. _.~.ProductSearch.by_sku: https://my-magento.readthedocs.io/en/latest/search_module.html#magento.search.ProductSearch.by_sku
.. |.~.SearchQuery| replace:: ``SearchQuery``
.. _.~.SearchQuery: https://my-magento.readthedocs.io/en/latest/search_module.html#magento.search.SearchQuery
.. |.~.SearchQuery.by_id| replace:: ``by_id()``
.. _.~.SearchQuery.by_id: https://my-magento.readthedocs.io/en/latest/search_module.html#magento.search.SearchQuery.by_id
.. |.~.SearchQuery.by_list| replace:: ``by_list()``
.. _.~.SearchQuery.by_list: https://my-magento.readthedocs.io/en/latest/search_module.html#magento.search.SearchQuery.by_list
.. |.~.SearchQuery.result| replace:: ``result``
.. _.~.SearchQuery.result: https://my-magento.readthedocs.io/en/latest/search_module.html#magento.search.SearchQuery.result
.. |.~.USER_CREDENTIALS| replace:: ``USER_CREDENTIALS``
.. _.~.USER_CREDENTIALS: https://my-magento.readthedocs.io/en/latest/clients.html#magento.clients.Client.USER_CREDENTIALS
.. |.~.add_criteria| replace:: ``add_criteria()``
.. _.~.add_criteria: https://my-magento.readthedocs.io/en/latest/search_module.html#magento.search.SearchQuery.add_criteria
.. |.~.authenticate| replace:: ``authenticate()``
.. _.~.authenticate: https://my-magento.readthedocs.io/en/latest/clients.html#magento.clients.Client.authenticate
.. |.~.by_id| replace:: ``by_id()``
.. _.~.by_id: https://my-magento.readthedocs.io/en/latest/search_module.html#magento.search.SearchQuery.by_id
.. |.~.by_list| replace:: ``by_list()``
.. _.~.by_list: https://my-magento.readthedocs.io/en/latest/search_module.html#magento.search.SearchQuery.by_list
.. |.~.delete| replace:: ``delete()``
.. _.~.delete: https://my-magento.readthedocs.io/en/latest/clients.html#magento.clients.Client.delete
.. |.~.execute_search| replace:: ``execute_search()``
.. _.~.execute_search: https://my-magento.readthedocs.io/en/latest/search_module.html#magento.search.SearchQuery.execute_search
.. |.~.get| replace:: ``get()``
.. _.~.get: https://my-magento.readthedocs.io/en/latest/clients.html#magento.clients.Client.get
.. |..get_api| replace:: ``get_api()``
.. _..get_api: https://my-magento.readthedocs.io/en/latest/modules.html#magento.get_api
.. |.~.get_api| replace:: ``get_api()``
.. _.~.get_api: https://my-magento.readthedocs.io/en/latest/modules.html#magento.get_api
.. |.~.post| replace:: ``post()``
.. _.~.post: https://my-magento.readthedocs.io/en/latest/clients.html#magento.clients.Client.post
.. |.~.put| replace:: ``put()``
.. _.~.put: https://my-magento.readthedocs.io/en/latest/clients.html#magento.clients.Client.put
.. |.~.restrict_fields| replace:: ``restrict_fields()``
.. _.~.restrict_fields: https://my-magento.readthedocs.io/en/latest/search_module.html#magento.search.SearchQuery.restrict_fields
.. |.~.scope| replace:: ``scope``
.. _.~.scope: https://my-magento.readthedocs.io/en/latest/clients.html#magento.clients.Client.scope
.. |.~.search| replace:: ``search()``
.. _.~.search: https://my-magento.readthedocs.io/en/latest/clients.html#magento.clients.Client.search
.. |.~.since| replace:: ``since()``
.. _.~.since: https://my-magento.readthedocs.io/en/latest/search_module.html#magento.search.SearchQuery.since
.. |.~.until| replace:: ``until()``
.. _.~.until: https://my-magento.readthedocs.io/en/latest/search_module.html#magento.search.SearchQuery.until
.. |.~.url_for| replace:: ``url_for()``
.. _.~.url_for: https://my-magento.readthedocs.io/en/latest/clients.html#magento.clients.Client.url_for
.. |.~.views| replace:: ``views``
.. _.~.views: https://my-magento.readthedocs.io/en/latest/clients.html#magento.clients.Store.views

..  Title: MyMagento
..  Description: A Python package that wraps and extends the Magento 2 REST API
..  Author: TDKorn

.. meta::
   :title: MyMagento
   :description: A Python package that wraps and extends the Magento 2 REST API

.. |RTD| replace:: **Explore the docs »**
.. _RTD: https://my-magento.readthedocs.io/en/latest/
.. |api_endpoint| replace:: API endpoint
.. _api_endpoint: https://adobe-commerce.redoc.ly/2.3.7-admin/




.. raw:: html

   <div align="center">

.. image:: https://raw.githubusercontent.com/TDKorn/my-magento/v2.2.0/docs/source/_static/magento_orange.png
   :alt: Logo for MyMagento: Python Magento 2 REST API Wrapper
   :width: 15%



.. raw:: html

   <h1>MyMagento🛒</h1>


A Python package that wraps and extends the Magento 2 REST API


|RTD|_



.. image:: https://img.shields.io/pypi/v/my-magento?color=eb5202
   :target: https://pypi.org/project/my-magento/
   :alt: PyPI Version

.. image:: https://img.shields.io/badge/GitHub-my--magento-4f1abc
   :target: https://github.com/tdkorn/my-magento
   :alt: GitHub Repository

.. image:: https://static.pepy.tech/personalized-badge/my-magento?period=total&units=none&left_color=grey&right_color=blue&left_text=Downloads
    :target: https://pepy.tech/project/my-magento

.. image:: https://readthedocs.org/projects/my-magento/badge/?version=latest
    :target: https://my-magento.readthedocs.io/en/latest/?badge=latest
    :alt: Documentation Status

.. raw:: html

   </div>

|

About MyMagento
~~~~~~~~~~~~~~~~~~~~

.. raw:: html

   <table>
       <tr align="left">
           <th>

📝 What's MyMagento?

.. raw:: html

   </th>
   <tr><td>

``MyMagento`` is a highly interconnected package that wraps and extends the Magento 2 REST API,
providing a more intuitive and user-friendly interface to access and update your store.

.. raw:: html

   </td></tr>
   </table>



MyMagento simplifies interaction with the Magento 2 REST API
=================================================================

If you've worked with the Magento 2 API, you'll know that not all endpoints are created equally.

``MyMagento`` aims to streamline your workflow by simplifying a
variety of commonly needed API operations.

...

Main Components
===============

.. raw:: html

   <table>
       <tr align="left">
           <th>

💻 The |.~.Client|_

.. raw:: html

   </th>
   <tr><td>

* Handles all API interactions
* Supports multiple store views
* Provides access to all other package components

.. raw:: html

   </td></tr>
   </table>


.. raw:: html

   <table>
       <tr align="left">
           <th>

🔍 The |.~.Manager|_ Subclasses

.. raw:: html

   </th>
   <tr><td>

* Manages interaction with API endpoints
* Allows executing searches, creating, and updating resources
* Provides an intuitive interface for `Managing Resources <https://my-magento.readthedocs.io/en/latest/interact-with-api.html>`_
* Supports advanced operations like `get_or_create`, simplifying workflows

.. raw:: html

   </td></tr>
   </table>


.. raw:: html

   <table>
       <tr align="left">
           <th>

🧠 The |.~.Model|_ Subclasses

.. raw:: html

   </th>
   <tr><td>

* Wrap all API responses in the package
* Provide additional endpoint-specific methods to retrieve and update data
* `FetchedOnlyModel` subclass can only be retrieved from the API, not created directly
* `ImmutableModel` subclass cannot be modified after initialization and throws an error if `save()` is called

.. raw:: html

   </td></tr>
   </table>


...

Available Endpoints
===================

``MyMagento`` is compatible with every |api_endpoint|_

Endpoints are wrapped with a |.~.Model|_ and |.~.Manager|_ subclass as follows:

.. csv-table::
   :header: "**Endpoint**", "**Client Shortcut**", "|.~.Manager|_ **Subclass**", "|.~.Model|_ **Subclass**"

   "``orders``", "|..Client.orders|_", "|.~.OrderManager|_", "|.~.Order|_"
   "``orders/items``", "|..Client.order_items|_", "|.~.OrderItemManager|_", "|.~.OrderItem|_"
   "``invoices``", "|..Client.invoices|_", "|.~.InvoiceManager|_", "|.~.Invoice|_"
   "``products``", "|..Client.products|_", "|.~.ProductManager|_", "|.~.Product|_"
   "``products/attributes``", "|..Client.product_attributes|_", "|.~.ProductAttributeManager|_", "|.~.ProductAttribute|_"
   "``products/attributes/{attribute_code}/options``", "|..Client.product_attribute_options|_", "|.~.ProductAttributeOptionManager|_", "|.~.AttributeOption|_"
   "``categories``", "|..Client.categories|_", "|.~.CategoryManager|_", "|.~.Category|_"
   "``customers``", "|..Client.customers|_", "|.~.CustomerManager|_", "|.~.Customer|_"
   "``shipments``", "|..Client.shipments|_", "|.~.ShipmentManager|_", "|.~.Shipment|_"
   "``attribute_sets``", "|..Client.attribute_sets|_", "|.~.AttributeSetManager|_", "|.~.AttributeSet|_"
   "``coupons``",    "|..Client.coupons|_",    "|.~.CouponManager|_",    "|.~.Coupon|_"

...

⚙ Installing MyMagento
~~~~~~~~~~~~~~~~~~~~~~~~~~~~

To install using ``pip``::

   pip install onesila-magneto

Please note that ``MyMagento`` requires ``Python >= 3.10``

...

📚 Documentation
~~~~~~~~~~~~~~~~

Full documentation can be found on `ReadTheDocs <https://my-magento.readthedocs.io/en/latest/>`_

|

QuickStart: Login with MyMagento
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

``MyMagento`` uses the |.~.Client|_ class to handle all interactions with the API.

.. raw:: html

   <table>
       <tr align="left">
           <th>

💡 Tip

.. raw:: html

   </th>
   <tr><td>

See `Get a Magento 2 REST API Token With MyMagento <https://my-magento.readthedocs.io/en/latest/examples/logging-in.html>`_ for full details on generating an access token

.. raw:: html

   </td></tr>
   </table>


Setting the Login Credentials
=============================

To generate an |.~.ACCESS_TOKEN|_ you'll need to |.~.authenticate|_ your |.~.USER_CREDENTIALS|_.

Creating a |.~.Client|_ requires a ``domain``, ``username``, and ``password`` at minimum.

.. code-block:: python

   >>> domain = 'website.com'
   >>> username ='username'
   >>> password = 'password'

If you're using a local installation of Magento you'll need to set ``local=True``. Your domain should look like this:

.. code-block:: python

   >>> domain = '127.0.0.1/path/to/magento'


...

Getting a |.~.Client|_
======================

Option 1: Initialize a |.~.Client|_ Directly
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^

.. code-block:: python

      from magento import Client

      >>> api = Client(domain, username, password, **kwargs)


Option 2: Call |.~.get_api|_
^^^^^^^^^^^^^^^^^^^^^^^^^^^^

.. code-block:: python

      import magento

      >>> api = magento.get_api(**kwargs)

|..get_api|_ takes the same keyword arguments as the |.~.Client|_

* If the ``domain``, ``username``, or ``password`` are missing,
  it will attempt to use the following environment variables:

.. code-block:: python

   import os

   os.environ['MAGENTO_DOMAIN'] = domain
   os.environ['MAGENTO_USERNAME']= username
   os.environ['MAGENTO_PASSWORD']= password


...

Getting an |.~.ACCESS_TOKEN|_
=============================

Unless you specify ``login=False``, the |.~.Client|_ will automatically call |.~.authenticate|_ once initialized:

.. code-block:: python

   >> api.authenticate()

   |[ MyMagento | website_username ]|:  Authenticating username on website.com...
   |[ MyMagento | website_username ]|:  Logged in to username


|

Managing Resources with Managers
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

The |.~.Manager|_ subclasses now handle all interactions with API endpoints, including searching, creating, and updating resources.

**Basic Example**: Searching for an order by ID

.. code-block:: python

    order = api.orders.by_id(12345)
    print(order)

**Creating a New Product**:

.. code-block:: python

    product_data = {
        "sku": "new-sku",
        "name": "New Product",
        "attribute_set_id": 4,
        "price": 199.99,
    }
    product = api.products.create(data=product_data)
    print(product)

**Using `get_or_create`:**

.. code-block:: python

   product, created = api.products.get_or_create(
       data={
           "sku": "existing-sku",
           "name": "Existing Product",
           "attribute_set_id": 4,
           "price": 199.99,
       },
       identifier="sku"
   )
   if created:
       print("New product created:", product)
   else:
       print("Product already exists:", product)

.. code-block:: python

   from magento.models.coupon import CouponSpec

   # Example: Get or Create a Coupon
   coupon_data = {
       "rule_id": 1,
       "code": "WELCOME10",
       "expiration_date": "2023-12-31",
   }
   coupon, created = api.coupons.get_or_create(
       data=coupon_data,
       identifier="code"
   )
   if created:
       print("New coupon created:", coupon)
   else:
       print("Coupon already exists:", coupon)

**Saving Changes to a Model**:

.. code-block:: python

    attribute = api.product_attributes.by_code('test')
    option = AttributeOption(data={}, attribute=attribute, client=api)
    option.label = 'New Label'
    option.sort_order = 3
    option.save()
    print(f"Attribute option saved with label: {option.label}")

Building Custom Queries with Managers
=====================================

While predefined methods cover most use cases, you can still build custom queries using Managers.

**Example: Retrieve Orders Over $50 Placed Since 2023**:

.. code-block:: python

    orders = api.orders.add_criteria(
        field="grand_total",
        value="50",
        condition="gt"
    ).since("2023-01-01").execute_search()

    for order in orders:
        print(order)

**Example: Get or Create an Attribute Option**:

.. code-block:: python

    attribute = api.product_attributes.by_code('color')
    option, created = api.product_attribute_options.get_or_create(
        data={"label": "Red", "sort_order": 1},
        identifier="label"
    )
    if created:
        print("New option created:", option)
    else:
        print("Option already exists:", option)


Managing Immutable Models
~~~~~~~~~~~~~~~~~~~~~~~~~

The `ImmutableModel` subclass is designed for resources that cannot be modified after creation. Calling `save()` on an instance of this subclass will raise an `OperationNotAllowedError`.

**Example**:

.. code-block:: python

    immutable_instance = ImmutableModel(data={}, client=api)
    try:
        immutable_instance.save()
    except OperationNotAllowedError as e:
        print(f"Error: {e}")

Managing Fetched-Only Models
~~~~~~~~~~~~~~~~~~~~~~~~~~~~

The `FetchedOnlyModel` subclass can only be retrieved via API calls and cannot be created directly. Attempting to initialize this model for creation will raise an `OperationNotAllowedError`.

**Example**:

.. code-block:: python

    try:
        fetched_instance = FetchedOnlyModel(data={}, client=api, endpoint='endpoint', fetched=False)
    except OperationNotAllowedError as e:
        print(f"Error: {e}")

Making Authorized Requests
~~~~~~~~~~~~~~~~~~~~~~~~~~~

The |.~.Client|_ can be used to generate the |.~.url_for|_ any API endpoint,
including a store |.~.scope|_.

You can use this URL to make an authorized
|.~.get|_, |.~.post|_, |.~.put|_, or |.~.delete|_ request.

Example: Making a |.~.get|_ Request
===================================

.. code-block:: python

 # Request the data for credit memo with id 7
 >>> url = api.url_for('creditmemo/7')
 >>> response = api.get(url)
 >>> print(response.json())

 {'adjustment': 1.5, 'adjustment_negative': 0, 'adjustment_positive': 1.5, 'base_adjustment': 1.5,  ... }

.. raw:: html

   <table>
       <tr align="left">
           <th>

📝 Note

.. raw:: html

   </th>
   <tr><td>

A |.~.search|_ is simpler than making |.~.get|_ requests, as the result will
be wrapped by  |.~.APIResponse|_ or other |.~.Model|_

.. code-block:: python

     # Retrieve credit memo with id 7 using a search
     >>> memo = api.manager("creditmemo").by_id(7)
     >>> print(memo.data)
     >>> print(memo)

     {'adjustment': 1.5, 'adjustment_negative': 0, 'adjustment_positive': 1.5, 'base_adjustment': 1.5,  ... }

